## ç›®æ ‡

ç”±æ­¤[è®¾æƒ³](https://www.zhihu.com/question/1987275119991732111/answer/2000122318920377777)ï¼Œä»æœ¨å…°é‡ç°é¡¹ç›®çš„[æäº¤å†å²](https://gitee.com/MulanRevive/mulan-rework/commits/master?page=56)æ‰¾åˆ°å¯¹åº”[æäº¤](43fab66ac6b760a71682ddf755ddb86173381801)ã€‚

ç›¸å¯¹äºåŸå§‹è®¾æƒ³å°‘äº†å‡½æ•°å®šä¹‰éƒ¨åˆ†ï¼ŒPythonä»£ç ä»ä¸€åƒä¸€ä¸‹é™åˆ°çº¦å…«ç™¾è¡Œï¼Œå…¶ä¸­ä¸¤ç™¾è¡Œæµ‹è¯•ä»£ç ã€ä¸€ç™¾ä¸‰çš„[å¼€å‘è¾…åŠ©ä»£ç ](https://gitee.com/MulanRevive/mulan-rework/blob/43fab66ac6b760a71682ddf755ddb86173381801/python.py)ï¼Œç®—ä¸‹æ¥å®ç°éƒ¨åˆ†äº”ç™¾è¡Œä¸åˆ°ï¼Œå…¶ä¸­åˆ†æå™¨éƒ¨åˆ†çº¦ä¸¤ç™¾å¤šã€‚

å…ˆè¯•äº†å›é€€åˆ°è¯¥æäº¤ï¼Œåœ¨py3.7ä¸‹å¯è¿è¡Œå¦‚ä¸‹`ç´¯ç§¯.ul`ï¼š

```
limit = 4
num = 1
sum = 0
while num <= limit {
    sum = sum + num
    num = num + 1
}

print(sum)
```

ä¸è¿‡ç¬¬å…«è¡Œä¸ºç©ºè¡Œåˆ™æŠ¥é”™å¦‚ä¸‹ï¼Œéœ€æ”¹è¿›åé¦ˆå¯è¯»æ€§ï¼š

```
rply.æŠ¥é”™.è¯­æ³•åˆ†ææŠ¥é”™: (None, SourcePosition(idx=87, lineno=8, colno=1))
```

å»æ‰ç©ºè¡Œï¼Œè¿è¡ŒæˆåŠŸï¼š

```
% python ä¸­.py æµ‹è¯•/ç´¯ç§¯.ul
10
```

å¦ä¹Ÿæ‰“ç®—æ”¯æŒä¸­æ–‡æ ‡è¯†ç¬¦ï¼Œé¢å¤–å·¥ä½œé‡åº”è¯¥æœ‰é™ã€‚

ä»¥æ­¤ä¸ºç›®æ ‡ï¼Œè¿›è¡Œé‡ç°ã€‚åœ¨å†ç”»ä¸€ä¸ªé¸¡è›‹çš„è¿‡ç¨‹ä¸­ï¼Œæ”¹è¿›åé¦ˆä¿¡æ¯ã€æé«˜rplyå®šåˆ¶ç‰ˆçš„æ˜“ç”¨æ€§ç­‰ã€‚

## ç¬¬ä¸€æ­¥

å¼€å§‹è€ƒè™‘å…ˆç”¨py3.7ä¹‹åå†æ”¯æŒåˆ°3.13ï¼Œå¼€å‘æµç¨‹ä¸å‰ç±»ä¼¼ï¼Œæ¯ä¸ªå°æäº¤åŒ…å«æµ‹è¯•ã€‚ä¹‹å‰åˆ°è¿™ä¸ªè¿›åº¦çº¦å…«åä¸ªæäº¤ï¼Œè¿™æ¬¡å¸Œæœ›ä¼šç•¥å°‘ã€‚

ç¬¬ä¸€æ­¥åŸæœ¬æŒ‰ç…§[æ­¤è¿›å±•å°ç»“](https://zhuanlan.zhihu.com/p/129740212)ï¼Œå‚ç…§2020å¹´å››æœˆåäºŒçš„[æäº¤](https://gitee.com/MulanRevive/mulan-rework/tree/edb50ab3587ea86c521f039a66f3d35b2435b6df/)ã€‚ä½†åœ¨py3.7.10ä¸‹è¿è¡Œ `python æ•°.py` æŠ¥é”™ï¼š`AttributeError: 'Num' object has no attribute 'n'`ã€‚å‘ç°`ast.Num`çš„å±æ€§åº”ä¸ºnè€Œévalueï¼ˆä¼°è®¡å½“å¹´å°è¯•åšå„ç§åŸå‹æ—¶è¿˜æ²¡æ³¨æ„pyç‰ˆæœ¬ï¼‰ã€‚

å¦è€ƒè™‘åˆ°å°½é‡å‡å°‘é¢å¤–å·¥ä½œé‡ä¹Ÿæ–¹ä¾¿æœ‰å…´è¶£è€…å¤ç°ï¼Œé€‰æ‹©ä»æ­¤é¡¹ç›®ä¼Šå§‹å°±ç›´æ¥ç”¨å½“å‰æœ¨å…°é‡ç°é¡¹ç›®æ”¯æŒçš„Pythonæœ€é«˜ç‰ˆæœ¬3.13ã€‚

æ¥ä¸‹æ¥å¾ˆå¿«å¤ç°äº†å•ä¸ªæ•°å­—çš„è§£æï¼Œä½†ç”¨æœ¨å…°é‡ç°çš„[å‘å¸ƒç‰ˆ](https://pypi.org/project/ulang/)ç”Ÿæˆè¯­æ³•æ ‘æ—¶ï¼Œå‘ç°å…¶æ— æ³•è§£æå•ä¸ªæ•°å­—ï¼š

```
% æœ¨å…° -æ ‘ æ•°.ul
 ğŸ˜° è¯­æ³•é”™è¯¯ï¼šæ–‡ä»¶ "æ•°.ul", ç¬¬1è¡Œ, ç¬¬1åˆ—, æ²¡è®¤å‡ºè¿™ä¸ªè¯ "æ•´æ•°"
âœ‹3
```

äºæ˜¯æ”¹ç¬¬ä¸€æ­¥ç›®æ ‡ä¸ºè¾“å‡ºå¿…éœ€çš„`print`ï¼Œæƒ³æ¥ä¹Ÿåˆç†ã€‚æ—©å…ˆè¿˜è®¾æƒ³è¿‡[å°†æ•°å­¦éƒ¨åˆ†ä½œä¸ºä¸“ç”¨åº“ç½®äºè¯­è¨€ä¹‹å¤–](https://www.zhihu.com/question/625640683/answer/3246258623)ã€‚

ä»£ç å·²å¼€æºåˆ°ï¼š

https://gitee.com/MulanRevive/subset-one

çº¦å…­åè¡ŒPythonä»£ç ã€‚

----

è‰ç¨¿

## è¿‡ç¨‹

æ•°.ul
4 

```
 ğŸ˜° è¯­æ³•é”™è¯¯ï¼šæ–‡ä»¶ "æ•°.ul", ç¬¬1è¡Œ, ç¬¬1åˆ—, æ²¡è®¤å‡ºè¿™ä¸ªè¯ "æ•´æ•°"
âœ‹4
â€œ/Users/xuanwu/opt/anaconda3/envs/py3_13/lib/python3.13/site-packages/æœ¨å…°/åˆ†æå™¨/è¯­æ³•åˆ†æå™¨.pyâ€ç¬¬1333è¡Œï¼šraise è¯­æ³•é”™è¯¯(
è°ƒç”¨å±‚çº§å¦‚ä¸‹
â€œ/Users/xuanwu/opt/anaconda3/envs/py3_13/lib/python3.13/site-packages/rply/è¯­æ³•åˆ†æå™¨.pyâ€ç¬¬67è¡Œï¼šè‡ªèº«.error_handler(state, é¢„è¯»)
â€œ/Users/xuanwu/opt/anaconda3/envs/py3_13/lib/python3.13/site-packages/æœ¨å…°/åˆ†æå™¨/è¯­æ³•åˆ†æå™¨.pyâ€ç¬¬1382è¡Œï¼šèŠ‚ç‚¹ = self.åˆ†æå™¨.åˆ†æ(å„è¯, state=self)
â€œ/Users/xuanwu/opt/anaconda3/envs/py3_13/lib/python3.13/site-packages/æœ¨å…°/ä¸­.pyâ€ç¬¬150è¡Œï¼šèŠ‚ç‚¹ = åˆ†æå™¨.åˆ†æ(æºç , æºç æ–‡ä»¶)
```

ä¿®æ”¹ç¬¬ä¸€æ­¥ç›®æ ‡ï¼š

```
print
```

ä¿®æ”¹æœ¨å…° 0.1.9 ä»£ç ï¼š


from æœ¨å…°.åŠŸç”¨.è°ƒè¯•è¾…åŠ© import è¯­æ³•æ ‘ç›¸å…³

            print(è¯­æ³•æ ‘ç›¸å…³.æ ¼å¼åŒ–èŠ‚ç‚¹(èŠ‚ç‚¹, 1))



æŠ¥é”™ï¼š
```
Traceback (most recent call last):
  File "/Users/xuanwu/work/ulang/å­é›†/ä¸­.py", line 18, in <module>
    å¯æ‰§è¡Œç  = compile(èŠ‚ç‚¹, æºç æ–‡ä»¶, 'exec')
               ~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: required field "lineno" missing from expr
```

ä¸ºä½•æœ¨å…°é‡ç°çš„è¯­æ³•æ ‘é‡Œæ²¡æœ‰args,keywords, type_ignores æ˜¯å› ä¸ºç©ºå—ï¼Ÿ

å› ä¸ºé»˜è®¤ç”¨ ast.dumpï¼Œæ”¹ç”¨ `print(è¯­æ³•æ ‘ç›¸å…³.æ ¼å¼åŒ–èŠ‚ç‚¹(èŠ‚ç‚¹, 1))`
ä¹‹åç›¸åŒ

å·²ä¸­æ–‡åŒ–æ ‡è¯†ç¬¦ï¼Œrplyçš„APIè°ƒç”¨

æ”¹ä¸ºprintråï¼Œè¿è¡Œå¦‚æœŸæŠ¥é”™ï¼ˆpy 3.13ï¼‰ï¼š
```
Traceback (most recent call last):
  File "/Users/xuanwu/work/ulang/å­é›†/ä¸­.py", line 20, in <module>
    exec(å¯æ‰§è¡Œç , {})
    ~~~~^^^^^^^^^^^^^^
  File "è¾“å‡º.ul", line 1, in <module>
    printr
    
NameError: name 'printr' is not defined. Did you mean: 'print'?
```

## ç›®çš„

åŠ å¼ºï¼š
- å¯è°ƒè¯•
- æŠ¥é”™ä¿¡æ¯ä¸­æ–‡åŒ–

rply å¯ç”¨æ€§æé«˜

